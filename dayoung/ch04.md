# ch04. 중급 SQL
## 4.1 조인 표현식
자연조인
- 두 개에 릴레이션에서 수행하고 하나의 릴레이션을 결과로 제공
  - 자연조인의 결과는 하나의 릴레이션
- use 절을 이용해 특정 속성에 대해 일치되는 값만 이용 가능

3개 이상 조인 시 
```sql
-- 비권장
select title
from student join takes join course

-- 권장
select title
from (student join takes) join course using course_id
```

조인 조건
- on 조건으로 조인을 수행할 릴레이션에 대해 일반적인 술어를 사용 가능
```sql
select title
from student join takes on student.id=takes.id

select title
from student, takes 
where student.id=takes.id
```

외부조인
- left outer join : 연산 왼쪽 릴레이션의 튜플을 보존
- right outer join : 오른쪽 연산 릴레이션 튜플을 보존
- full outer join : 듀 릴레이션 튜플을 보존

조인 종류
- inner join : 일반적인 조인(그냥 join이라고 함.. 자연 내부 조인)
- outer join

## 4.2 뷰
SQL이 제공하는 가상 릴레이션. with 절을 사용
```sql
create view v as <query>
-- 예시
create view v as 
    select id, title
    from instructor
```

뷰 사용
- 뷰를 생성한 시점 이후 릴레이션이 수정 되었다면 뷰 상태는 최신이 아니게 됨
  - SQL에서 내부적으로 질의에서 뷰 릴레이션이 나타날 때 마다 뷰 릴레이션을 재계산

실체화 뷰
- 뷰를 정의하는데 사용한 릴레이션이 수정되어도 최신 상태를 유지하는 뷰
- 데이터베이스에 따라 다르지만 뷰 갱신 시점은 관리자가 정할 수 있음

뷰 갱신
- 뷰는 삽입을 거부
- DB마다 뷰 갱신을 허용하는 조건은 차이가 있음
  - from절은 오직 한 개의 데이터베이스 릴레이션을 가지고
  - select는 오직 릴레이션 속성 이름만 포함. expression, aggrgate, distint를 가져선 안됨
  - select에 나열되지 않은 어떤 속성도 널값 허용해야 함.
  - 질의는 group by, having 절을 가지면 안됨

## 4.3 트랜잭션
- 질의, 갱신문의 sequence로 되어있음

트랜잭션은 아래 둘 중 하나로 끝나야 함
- Commit work
  - 트랜잭션이 수행한 갱신을 DB에 영구적으로 반영
- Rollback work
  - SQL에서 수행된 모든 갱신을 취소. 트랜잭션 첫 구문 실행 전 상태로 돌아감

## 4.4 무결성 제약조건(integrity constraint)
권한이 주어진 유저로부터의 데이터베이스 변경이 데이터 일관성 손실을 초래하지 않음을 보장.
-> 데이터 무결성 보장하는거~ 데이터 입력 규칙 지켜라

ex)
- 교수 이름은 null이 될 수 없다
- 서로 다른 교수가 같은 ID를 가질 수 없다
- 학과 예산은 0보다 커야한다
- course 릴레이션과 dept 릴레이션의 학과 명은 일치해야 한다

## Q
1. View는 어떤 상황에서 사용 될 수 있나요? 성능 저하가 발생하지는 않나요? 만약에 성능 저하가 발생한다면 그럼에도 불구하고 해당 상황에서 View를 사용해야 하는 이유는 무엇인가요?


------